WebFont.load({google:{families:["Open+Sans:800,600,400"]}});var firebaseConfig={apiKey:"AIzaSyAlNxQoCCIBMFpCyrS8hY4NJDaqW6Kxyfk",authDomain:"unc-zoom-background-generator.firebaseapp.com",databaseURL:"https://unc-zoom-background-generator-default-rtdb.firebaseio.com",projectId:"unc-zoom-background-generator",storageBucket:"unc-zoom-background-generator.appspot.com",messagingSenderId:"854882791014",appId:"1:854882791014:web:2d6b2372027ea212a8c7a7",measurementId:"G-9TWD8B1KYP"},database=null;firebase.apps.length||(firebase.initializeApp(firebaseConfig),firebase.analytics(),database=firebase.database());var fillStyle={blank:"rgba(255, 255, 255, 0)",carolinaBlue:"#4B9CD3",carolinaDarkBlue:"#13294B",defaultBackgroundColor:"#4B9CD3",translucentWhite:"rgba(255, 255, 255, 0.2)",white:"#FFFFFF"},elements={appContainer:document.getElementById("app-container"),colorSelector:document.getElementById("color"),downloadButton:document.getElementById("download"),nameForm:document.getElementById("name-form"),firstNameInput:document.getElementById("first-name"),lastNameInput:document.getElementById("last-name"),namePlaceholder:document.getElementById("name-placeholder"),logoSelector:document.getElementById("logo"),pronounSelector:document.getElementById("pronouns")},firstAvailableWidth=0,lastAvailableWidth=0,maxTextWidth=610,initialRight=-77,canvas=document.getElementById("c"),context=canvas.getContext("2d"),firstNameCanvas=document.getElementById("first-name-canvas"),firstNameContext=firstNameCanvas.getContext("2d"),firstNameCanvasInitialRight=initialRight,lastNameCanvas=document.getElementById("last-name-canvas"),lastNameContext=lastNameCanvas.getContext("2d"),lastNameCanvasInitialRight=initialRight,nameBarPlaceholderOpacity=elements.namePlaceholder.style.opacity,initialState={background_color:fillStyle.defaultBackgroundColor,first_name:"",last_name:"",logo:"",pronouns:!1},state=initialState,actions={updateBackgroundColor:"UPDATE_BACKGROUND_COLOR",updateFirstName:"UPDATE_FIRST_NAME",updateLastName:"UPDATE_LAST_NAME",updateLogo:"UPDATE_LOGO",updatePronouns:"UPDATE_PRONOUNS"};function reducer(e,t={}){switch(t.type){case"UPDATE_BACKGROUND_COLOR":return{...e,background_color:t.payload};case"UPDATE_FIRST_NAME":return{...e,first_name:t.payload};case"UPDATE_LAST_NAME":return{...e,last_name:t.payload};case"UPDATE_LOGO":return{...e,logo:t.payload};case"UPDATE_PRONOUNS":return{...e,pronouns:t.payload};default:return e}}function updateState(e,t){(state=reducer(state,{type:e,payload:t})).first_name||state.last_name||state.pronouns?elements.namePlaceholder.style.opacity=0:elements.namePlaceholder.style.opacity=nameBarPlaceholderOpacity}function forceChangeEvent(e,t){t=new Event(t,{bubbles:!0});e.dispatchEvent(t)}function clearRect({x:e,y:t,width:a=960,height:n}){context.fillStyle=state.background_color,context.clearRect(e,t,a,n),context.fillRect(e,t,a,n)}function syncRights(e){var t=firstNameCanvas.style.right.replace("px",""),a=lastNameCanvas.style.right.replace("px",""),n=Math.max(t,a);"last"==e?firstNameCanvas.style.right=n+"px":"first"==e&&(lastNameCanvas.style.right=n+"px");var o=lastAvailableWidth<firstAvailableWidth;0==firstAvailableWidth||0==lastAvailableWidth||(firstAvailableWidth<lastAvailableWidth?lastNameCanvas.style.right=firstNameCanvas.style.right:o&&(firstNameCanvas.style.right=lastNameCanvas.style.right)),forceChangeEvent(elements.pronounSelector,"change")}function updateFirstName(e){var t=e?10:0;firstNameContext.fillStyle=state.background_color,firstNameContext.fillRect(t,0,firstNameCanvas.width,firstNameCanvas.height),firstNameContext.font="800 112px Open Sans",firstNameContext.fillStyle=fillStyle.white,e?firstNameContext.fillRect(0,0,10,firstNameCanvas.height):firstNameContext.clearRect(0,0,firstNameCanvas.width,firstNameCanvas.height);var a=410-firstNameContext.measureText(e).width,n=Math.floor(firstNameCanvasInitialRight-a/2);n=25<=n?25:n,firstNameCanvas.style.right=a<=0?n+"px":firstNameCanvasInitialRight+"px",updateState(actions.updateFirstName,e),firstNameContext.fillText(e,40,108,maxTextWidth),firstAvailableWidth=a,syncRights("first")}function updateLastName(e){var t=e?10:0;lastNameContext.fillStyle=state.background_color,lastNameContext.fillRect(t,0,lastNameCanvas.width,lastNameCanvas.height),lastNameContext.font="600 88px Open Sans",lastNameContext.fillStyle=fillStyle.white,e?lastNameContext.fillRect(0,0,10,lastNameCanvas.height):lastNameContext.clearRect(0,0,lastNameCanvas.width,lastNameCanvas.height);var a=410-lastNameContext.measureText(e).width,n=Math.floor(lastNameCanvasInitialRight-a/2);n=25<=n?25:n,lastNameCanvas.style.right=a<=0?n+"px":lastNameCanvasInitialRight+"px",updateState(actions.updateLastName,e),lastNameContext.fillText(e,40,68,maxTextWidth),lastAvailableWidth=a,syncRights("last")}function updateName(e,t){"first-name"==e&&updateFirstName(t),"last-name"==e&&updateLastName(t)}function downloadImage(){var e=elements.appContainer.getBoundingClientRect().x,t=2*firstNameCanvas.getBoundingClientRect().x-2*e,a=firstNameContext.getImageData(0,0,652,136),n=lastNameContext.getImageData(0,0,652,96);state.first_name&&context.putImageData(a,t,50),state.last_name&&context.putImageData(n,t,186),canvas.toBlob((function(e){if(fileNameSuffix="",elements.firstNameInput.value&&elements.lastNameInput.value?(fileNameSuffix+="-"+elements.firstNameInput.value,fileNameSuffix+="-"+elements.lastNameInput.value):elements.firstNameInput.value?fileNameSuffix+="-"+elements.firstNameInput.value:elements.lastNameInput.value&&(fileNameSuffix+="-"+elements.lastNameInput.value),saveAs(e,"UNC-Zoom-Background"+fileNameSuffix),database){var t=database.ref().child("downloads/"),a=t.push().key;t.child(a).update(state,(e=>{if(!e)return!1;console.log("Firebase error: "+e)}))}}))}context.imageSmoothingQuality="high",context.fillStyle=state.background_color,context.fillRect(0,0,canvas.width,canvas.height),context.fillStyle=fillStyle.white,firstNameContext.imageSmoothingQuality="high",firstNameContext.fillStyle=state.background_color,firstNameCanvas.style.right=firstNameCanvasInitialRight+"px",lastNameContext.imageSmoothingQuality="high",lastNameContext.fillStyle=state.background_color,lastNameCanvas.style.right=lastNameCanvasInitialRight+"px",elements.firstNameInput.focus(),elements.nameForm.addEventListener("keyup",(function(e){state.first_name&&(elements.lastNameInput.disabled=!1),(8==e.which||46<e.which)&&updateName(e.target.name,e.target.value.trim())}),!1),elements.colorSelector.addEventListener("change",(function(e){var t=fillStyle[e.target.value];context.fillStyle=t,context.fillRect(0,0,canvas.width,canvas.height),updateState(actions.updateBackgroundColor,t),forceChangeEvent(elements.logoSelector,"change"),forceChangeEvent(elements.pronounSelector,"change"),updateFirstName(state.first_name),updateLastName(state.last_name)}),!1),elements.logoSelector.addEventListener("change",(function(e){var t={"unc-logo":"UNC-logo.png","kfbs-logo":"UNC-KFBS-logo.png"},a=e.target.value;if(clearRect({x:0,y:0,width:canvas.width/2,height:canvas.height/2}),t.hasOwnProperty(a)){var n=new Image;n.src=t[a],n.onload=()=>context.drawImage(n,0,0)}updateState(actions.updateLogo,a||!1)}),!1),elements.pronounSelector.addEventListener("change",(function(e){var t=["","He/him/his","She/her/hers","They/them/theirs","Ze/Hir/Hirs"],a=t[e.target.value],n=elements.appContainer.getBoundingClientRect().x,o=48+2*firstNameCanvas.getBoundingClientRect().x-2*n,i=126;i=state.first_name||state.last_name?state.last_name?364:256:126,clearRect({x:1224,y:48,width:960,height:330}),context.fillStyle=fillStyle.white,context.font="400 48px Open Sans",context.fillText(t[e.target.value],o,i),updateState(actions.updatePronouns,a||!1)}),!1),elements.downloadButton.addEventListener("click",(function(){downloadImage()}),!1),canvas.addEventListener("click",(function(){downloadImage()}),!1),function(e,t){if("function"==typeof define&&define.amd)define([],t);else if("undefined"!=typeof exports)t();else{t(),e.FileSaver={}}}(this,(function(){"use strict";var e="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0;function t(e,t,a){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){i(n.response,t,a)},n.onerror=function(){console.error("could not download file")},n.send()}function a(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return t.status>=200&&t.status<=299}function n(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(a){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=e.saveAs||("object"!=typeof window||window!==e?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(o,i,l){var s=e.URL||e.webkitURL,r=document.createElement("a");i=i||o.name||"download",r.download=i,r.rel="noopener","string"==typeof o?(r.href=o,r.origin!==location.origin?a(r.href)?t(o,i,l):n(r,r.target="_blank"):n(r)):(r.href=s.createObjectURL(o),setTimeout((function(){s.revokeObjectURL(r.href)}),4e4),setTimeout((function(){n(r)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,o,i){if(o=o||e.name||"download","string"==typeof e)if(a(e))t(e,o,i);else{var l=document.createElement("a");l.href=e,l.target="_blank",setTimeout((function(){n(l)}))}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,i),o)}:function(a,n,i,l){if((l=l||open("","_blank"))&&(l.document.title=l.document.body.innerText="downloading..."),"string"==typeof a)return t(a,n,i);var s="application/octet-stream"===a.type,r=/constructor/i.test(e.HTMLElement)||e.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&r||o)&&"undefined"!=typeof FileReader){var m=new FileReader;m.onloadend=function(){var e=m.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=e:location=e,l=null},m.readAsDataURL(a)}else{var d=e.URL||e.webkitURL,f=d.createObjectURL(a);l?l.location=f:location.href=f,l=null,setTimeout((function(){d.revokeObjectURL(f)}),4e4)}});e.saveAs=i.saveAs=i,"undefined"!=typeof module&&(module.exports=i)})),
/*! @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js */
function(e){"use strict";var t,a=e.Uint8Array,n=e.HTMLCanvasement,o=n&&n.prototype,i=/\s*;\s*base64\s*(?:;|$)/i,l="toDataURL",s=function(e){for(var n,o,i=e.length,l=new a(i/4*3|0),s=0,r=0,c=[0,0],m=0,d=0;i--;)o=e.charCodeAt(s++),255!==(n=t[o-43])&&undefined!==n&&(c[1]=c[0],c[0]=o,d=d<<6|n,4===++m&&(l[r++]=d>>>16,61!==c[1]&&(l[r++]=d>>>8),61!==c[0]&&(l[r++]=d),m=0));return l};a&&(t=new a([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),!n||o.toBlob&&o.toBlobHD||(o.toBlob||(o.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)e(this.mozGetAsFile("canvas",t));else if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t))e(this.msToBlob());else{var n,o=Array.prototype.slice.call(arguments,1),r=this[l].apply(this,o),c=r.indexOf(","),m=r.substring(c+1),d=i.test(r.substring(0,c));Blob.fake?((n=new Blob).encoding=d?"base64":"URI",n.data=m,n.size=m.length):a&&(n=d?new Blob([s(m)],{type:t}):new Blob([decodeURIComponent(m)],{type:t})),e(n)}}),!o.toBlobHD&&o.toDataURLHD?o.toBlobHD=function(){l="toDataURLHD";var e=this.toBlob();return l="toDataURL",e}:o.toBlobHD=o.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);