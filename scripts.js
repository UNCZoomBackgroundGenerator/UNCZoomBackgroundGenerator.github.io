function objectDidChange(e,t){var a=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);if(a.length!=n.length)return!0;for(var l=0;l<a.length;l++){var i=a[l];if("object"==typeof e[i]){for(var o=Object.getOwnPropertyNames(e[i]),s=Object.getOwnPropertyNames(t[i]),r=0;r<o.length;r++)if(nestedPropName=o[r],o[nestedPropName]!==s[nestedPropName])return console.log(nestedPropName),!0}else if(e[i]!==t[i])return!0}return!1}WebFont.load({google:{families:["Open+Sans:800,600,400"]}});var fillStyle={carolinaBlue:"#4B9CD3",translucentWhite:"rgba(255, 255, 255, 0.2)",white:"#FFFFFF"},canvas=document.getElementById("c"),context=canvas.getContext("2d"),firstNameCanvas=document.getElementById("first-name-canvas"),firstNameContext=firstNameCanvas.getContext("2d"),firstNameCanvasInitialRight=-77;firstNameContext.fillStyle=fillStyle.carolinaBlue,firstNameContext.fillRect(0,0,firstNameCanvas.width,firstNameCanvas.height),firstNameCanvas.style.right=firstNameCanvasInitialRight+"px";var lastNameCanvas=document.getElementById("last-name-canvas"),lastNameContext=lastNameCanvas.getContext("2d"),lastNameCanvasInitialRight=-77;lastNameContext.fillStyle=fillStyle.carolinaBlue,lastNameContext.fillRect(0,0,lastNameCanvas.width,lastNameCanvas.height),lastNameCanvas.style.right=lastNameCanvasInitialRight+"px";var firstAvailableWidth=0,lastAvailableWidth=0,elements={appContainer:document.getElementById("app-container"),downloadButton:document.getElementById("download"),nameForm:document.getElementById("name-form"),firstNameInput:document.getElementById("first-name"),lastNameInput:document.getElementById("last-name"),namePlaceholder:document.getElementById("name-placeholder"),logoSelector:document.getElementById("logo"),pronounSelector:document.getElementById("pronouns")},nameBarPlaceholderOpacity=elements.namePlaceholder.style.opacity,maxTextWidth=610,initialState={first_name:"",last_name:""},state=initialState,actions={updateAvailableWidth:"UPDATE_AVAILABLE_WIDTH",updateFirstName:"UPDATE_FIRST_NAME",updateLastName:"UPDATE_LAST_NAME",updateNameRect:"UPDATE_NAME_RECT",resetNameBarRect:"RESET_NAME_BAR_RECT",updateNameBarRect:"UPDATE_NAME_BAR_RECT",addPronouns:"ADD_PRONOUNS",removePronouns:"REMOVE_PRONOUNS"};function reducer(e,t={}){switch(t.type){case"UPDATE_FIRST_NAME":return{...e,first_name:t.payload};case"UPDATE_LAST_NAME":return{...e,last_name:t.payload};default:return e}}function captureObject(e){return Object.assign({},e)}function updateState(e,t){var a=captureObject(state);objectDidChange(state=reducer(state,{type:e,payload:t}),a)}function forceChangeEvent(e,t){t=new Event(t,{bubbles:!0});e.dispatchEvent(t)}function clearRect({x:e,y:t,width:a=960,height:n}){context.fillStyle=fillStyle.carolinaBlue,context.clearRect(e,t,a,n),context.fillRect(e,t,a,n)}function syncRights(e){var t=firstNameCanvas.style.right.replace("px",""),a=lastNameCanvas.style.right.replace("px",""),n=Math.max(t,a);"last"==e?firstNameCanvas.style.right=n+"px":"first"==e&&(lastNameCanvas.style.right=n+"px");var l=lastAvailableWidth<firstAvailableWidth;0==firstAvailableWidth||0==lastAvailableWidth||(firstAvailableWidth<lastAvailableWidth?lastNameCanvas.style.right=firstNameCanvas.style.right:l&&(firstNameCanvas.style.right=lastNameCanvas.style.right)),state.first_name||state.last_name?elements.namePlaceholder.style.opacity=0:elements.namePlaceholder.style.opacity=nameBarPlaceholderOpacity,forceChangeEvent(elements.pronounSelector,"change")}function updateFirstName(e){var t=e?10:0;firstNameContext.fillStyle=fillStyle.carolinaBlue,firstNameContext.fillRect(t,0,firstNameCanvas.width,firstNameCanvas.height),firstNameContext.font="800 112px Open Sans",firstNameContext.fillStyle=fillStyle.white,e&&firstNameContext.fillRect(0,0,10,firstNameCanvas.height);var a=410-firstNameContext.measureText(e).width,n=Math.floor(firstNameCanvasInitialRight-a/2);n=25<=n?25:n,firstNameCanvas.style.right=a<=0?n+"px":firstNameCanvasInitialRight+"px",updateState(actions.updateFirstName,e),firstNameContext.fillStyle=firstNameContext.white,firstNameContext.fillText(e,40,108,maxTextWidth),firstAvailableWidth=a,syncRights("first")}function updateLastName(e){var t=e?10:0;lastNameContext.fillStyle=fillStyle.carolinaBlue,lastNameContext.fillRect(t,0,lastNameCanvas.width,lastNameCanvas.height),lastNameContext.font="600 88px Open Sans",lastNameContext.fillStyle=fillStyle.white,e&&lastNameContext.fillRect(0,0,10,lastNameCanvas.height);var a=410-lastNameContext.measureText(e).width,n=Math.floor(lastNameCanvasInitialRight-a/2);n=25<=n?25:n,lastNameCanvas.style.right=a<=0?n+"px":lastNameCanvasInitialRight+"px",updateState(actions.updateLastName,e),lastNameContext.fillStyle=lastNameContext.white,lastNameContext.fillText(e,40,68,maxTextWidth),lastAvailableWidth=a,syncRights("last")}function updateName(e,t){"first-name"==e&&updateFirstName(t),"last-name"==e&&updateLastName(t)}function downloadImage(){var e=elements.appContainer.getBoundingClientRect().x,t=2*firstNameCanvas.getBoundingClientRect().x-2*e,a=firstNameContext.getImageData(0,0,652,136),n=lastNameContext.getImageData(0,0,652,96);context.putImageData(a,t,50),context.putImageData(n,t,186),canvas.toBlob(function(e){if(fileNameSuffix="",elements.firstNameInput.value&&elements.lastNameInput.value?(fileNameSuffix+="-"+elements.firstNameInput.value,fileNameSuffix+="-"+elements.lastNameInput.value):elements.firstNameInput.value?fileNameSuffix+="-"+elements.firstNameInput.value:elements.lastNameInput.value&&(fileNameSuffix+="-"+elements.lastNameInput.value),saveAs(e,"UNC-Zoom-Background"+fileNameSuffix),database){var t=database.ref().child("names/"),a=t.push().key;t.child(a).update({first_name:state.first_name||"",last_name:state.last_name||""},e=>{if(!e)return!1;console.log("Firebase error: "+e)})}})}context.imageSmoothingQuality="high",context.fillStyle=fillStyle.carolinaBlue,context.fillRect(0,0,canvas.width,canvas.height),context.fillStyle=fillStyle.white,elements.firstNameInput.focus(),elements.nameForm.addEventListener("keyup",function(e){state.first_name&&(elements.lastNameInput.disabled=!1),(8==e.which||46<e.which)&&updateName(e.target.name,e.target.value.trim())},!1),elements.logoSelector.addEventListener("change",function(e){var t={"unc-logo":"UNC-logo.png","kfbs-logo":"UNC-KFBS-logo.png"};if(clearRect({x:0,y:0,width:canvas.width/2,height:canvas.height/2}),t.hasOwnProperty(e.target.value)){var a=new Image;a.src=t[e.target.value],a.onload=(()=>context.drawImage(a,0,0))}},!1),elements.pronounSelector.addEventListener("change",function(e){var t=elements.appContainer.getBoundingClientRect().x,a=48+2*firstNameCanvas.getBoundingClientRect().x-2*t,n=state.last_name?364:324;clearRect({x:1224,y:284,width:960,height:94}),context.fillStyle=fillStyle.white,context.font="400 48px Open Sans",context.fillText(["","He/him/his","She/her/hers","They/them/theirs","Ze/Hir/Hirs"][e.target.value],a,n)},!1),elements.downloadButton.addEventListener("click",function(){downloadImage()},!1),canvas.addEventListener("click",function(){downloadImage()},!1),function(e,t){if("function"==typeof define&&define.amd)define([],t);else if("undefined"!=typeof exports)t();else{t(),e.FileSaver={}}}(this,function(){"use strict";var e="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0;function t(e,t,a){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){i(n.response,t,a)},n.onerror=function(){console.error("could not download file")},n.send()}function a(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return t.status>=200&&t.status<=299}function n(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(a){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var l=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=e.saveAs||("object"!=typeof window||window!==e?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(l,i,o){var s=e.URL||e.webkitURL,r=document.createElement("a");i=i||l.name||"download",r.download=i,r.rel="noopener","string"==typeof l?(r.href=l,r.origin!==location.origin?a(r.href)?t(l,i,o):n(r,r.target="_blank"):n(r)):(r.href=s.createObjectURL(l),setTimeout(function(){s.revokeObjectURL(r.href)},4e4),setTimeout(function(){n(r)},0))}:"msSaveOrOpenBlob"in navigator?function(e,l,i){if(l=l||e.name||"download","string"==typeof e)if(a(e))t(e,l,i);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout(function(){n(o)})}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,i),l)}:function(a,n,i,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof a)return t(a,n,i);var s="application/octet-stream"===a.type,r=/constructor/i.test(e.HTMLElement)||e.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||s&&r||l)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=m?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},c.readAsDataURL(a)}else{var f=e.URL||e.webkitURL,d=f.createObjectURL(a);o?o.location=d:location.href=d,o=null,setTimeout(function(){f.revokeObjectURL(d)},4e4)}});e.saveAs=i.saveAs=i,"undefined"!=typeof module&&(module.exports=i)}),function(e){"use strict";var t,a=e.Uint8Array,n=e.HTMLCanvasement,l=n&&n.prototype,i=/\s*;\s*base64\s*(?:;|$)/i,o="toDataURL",s=function(e){for(var n,l,i=e.length,o=new a(i/4*3|0),s=0,r=0,m=[0,0],c=0,f=0;i--;)l=e.charCodeAt(s++),255!==(n=t[l-43])&&void 0!==n&&(m[1]=m[0],m[0]=l,f=f<<6|n,4===++c&&(o[r++]=f>>>16,61!==m[1]&&(o[r++]=f>>>8),61!==m[0]&&(o[r++]=f),c=0));return o};a&&(t=new a([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),!n||l.toBlob&&l.toBlobHD||(l.toBlob||(l.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)e(this.mozGetAsFile("canvas",t));else if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t))e(this.msToBlob());else{var n,l=Array.prototype.slice.call(arguments,1),r=this[o].apply(this,l),m=r.indexOf(","),c=r.substring(m+1),f=i.test(r.substring(0,m));Blob.fake?((n=new Blob).encoding=f?"base64":"URI",n.data=c,n.size=c.length):a&&(n=f?new Blob([s(c)],{type:t}):new Blob([decodeURIComponent(c)],{type:t})),e(n)}}),!l.toBlobHD&&l.toDataURLHD?l.toBlobHD=function(){o="toDataURLHD";var e=this.toBlob();return o="toDataURL",e}:l.toBlobHD=l.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);
